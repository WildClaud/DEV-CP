<font style="font-size:16px; font-weight:bold; margin: 12px;">Print Manifest Report</font>
<br><br>
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr><td width="50%" valign="top">
<table cellpadding="2px" cellspacing="0" border="0">
<tr><td colspan="2"><b>Fastway Couriers Run Sheet</b></td></tr>
<tr><td><b>Date:</b></td>
	<td>[? print format_date({now=>1, format=>'#D/#M/#Y #g:#I:#S #a'}) ?]</td></tr>
<tr><td><b>Manifest Number:</b></td>
	<td>[? print $_DATA{manifest_number} ?]</td></tr>
<tr><td><b>Description:</b></td>
	<td>
<!--##[? 
my $description = ($_DATA{lodgement_title} eq ''? '': 'Lodged from '.$_DATA{lodgement_title}.' on ').format_date({now=>1, format=>'#W'});
print $description;
?]##--></td></tr>
</table>
</td>
<td width="50%" valign="top">
<font style="font-weight:bold;">
The liability of Fastway will end when a signature has been obtained upon delivery of the goods.<br>
Any damage or loss must be shown when goods are signed for.<br>
<b>Received in good order and condition</b>
</font>
</td></tr>
</table>
<br>
<table cellpadding="0" cellspacing="0" border="0">
	<tr><td colspan="2" align="right">Courier Franchise: ________________________________</td>
		<td colspan="2" align="right">Vehicle No: ________________________________</td></tr>
</table>
<br>
<table width="100%" cellpadding="4px" cellspacing="0" style="border:1px solid #000000;">
	<tr><td class="hdr" style="border:1px solid #000000;">From</td>
  	<td class="hdr" style="border:1px solid #000000;">To</td>
    <td class="hdr" style="border:1px solid #000000;">No. Pkgs</td>
    <td class="hdr" style="border:1px solid #000000;">Pickup Barcodes</td></tr>
<!--##[?
use  TagLib::barcode_url;

my $barcodefn = TagLib::barcode_url::__LOAD__();
if(ref($barcodefn) ne 'CODE') {
	$barcodefn = sub {};
}

$total_con =
$total_art = 0;

my $db_mid = db_quote($_DATA{manifest_id});

my %shdata = get_hash("SELECT A.module_param FROM SH_MANIFESTS M INNER JOIN SH_ACCOUNTS A USING (shacc_id) WHERE manifest_id=?",$_DATA{manifest_id});
my %mparam = extract_KV_data($shdata{module_param});
my $fmaddress = $mparam{ReturnName}.'<br>'.
	($mparam{ReturnAddressLine1} eq ''? '' : $mparam{ReturnAddressLine1}.'<br>').
	($mparam{ReturnAddressLine2} eq ''? '' : $mparam{ReturnAddressLine2}.'<br>').
	uc($mparam{ReturnSuburb}).' ,'.sprintf("%04d", $mparam{ReturnPostcode});

my $sql2 = "SELECT C.*, O.ship_zip, O.ship_country, O.ship_first_name, O.ship_last_name, O.ship_company, O.ship_street1, O.ship_street2, O.ship_city, ".
	"S.shserv_code, S.shserv_name ".
	"FROM SH_CONSIGNMENTS C INNER JOIN ORDERS O USING (order_id) LEFT JOIN SH_SERVICES S USING (shserv_id) ".
	"WHERE manifest_id=$db_mid ORDER BY cngmt_id";
my $sth2 = run_sql_dyn($sql2);
while($cng = $sth2->fetchrow_hashref) {
	my $db_cid = db_quote($cng->{cngmt_id});
	
	my $barcodes = '';
	
	my $art_count = 0;
	my $sql3 = "SELECT * FROM SH_ARTICLES WHERE cngmt_id=$db_cid ORDER BY art_id";
	my $sth3 = run_sql_dyn($sql3);
	while($row = $sth3->fetchrow_hashref) {
		
		
		my $pbarcode = $row->{barcode}.'P';
		my $url = &{$barcodefn}(undef, fn=>'article', height=>40, cngmt=>$row->{cngmt_id}, art=>$row->{art_id}, barcode=>$pbarcode, _DATA=>{});

		$barcodes .= qq~<img src="$url" border="0"/><br>
<font style="font-size:11px; font-weight:bold;">$pbarcode</font><br>
<br>~;

		$art_count++;
		$total_art++;
	}
	
	if($art_count > 0) {
		my $shipname = trim($cng->{ship_company});
		if($shipname eq '') {
			$shipname = trim($cng->{ship_first_name}.' '.$cng->{ship_last_name});
		}
		if($shipname eq '') {
			$shipname = '-';
		}
		
		my $toaddress = $shipname.'<br>'.
			($cng->{ship_street1} eq ''? '' : $cng->{ship_street1}.'<br>').
			($cng->{ship_street2} eq ''? '' : $cng->{ship_street2}.'<br>').
			uc($cng->{ship_city}).' ,'.sprintf("%04d", $cng->{ship_zip});
	
		print qq~##-->
<tr><td class="itm" valign="top" style="border:1px solid #000000;">$fmaddress</td>
	<td class="itm" valign="top" style="border:1px solid #000000;">$toaddress</td>
	<td class="itm" valign="top" style="border:1px solid #000000;">$art_count</td>
	<td class="itm" align="center" valign="top" style="border:1px solid #000000;">$barcodes</td></tr>
<!--##~;
	}

	$total_con++;
}

?]##-->
<tr><td colspan="4" style="border:1px solid #000000;">&nbsp;</td></tr>
<tr><td class="total" colspan="2" style="border:1px solid #000000;"><b>Parcel Total</b> (for  <!--##[? print $total_con.' '.($total_con==1?'consignment':'consignments') ?]##-->)</td>
<td class="total" colspan="2" style="border:1px solid #000000;"><!--##[? print $total_art ?]##--></td>
</table>
<table cellpadding="0" cellspacing="0" width="100%" border="0">
	<tr><td colspan="2" height="50px" align="right">Sender's signature ________________________________</td></tr>
</table>