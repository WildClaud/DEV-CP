<font style="font-size:16px; font-weight:bold; margin: 12px;">Print Manifest Report</font>
<br><br>
<table cellpadding="2px" cellspacing="0" border="0">
<tr><td><b>System Name:</b></td>
	<td>Neto-[? %mparam = extract_KV_data($_DATA{module_param});
		  print $mparam{'ReturnName'};
	?]</td></tr>
<tr><td><b>Transfer Type:</b></td>
	<td><b>FTP-CLN</b></td></tr>
<tr><td><b>Filename:</b></td>
	<td>[? print $_DATA{manifest_number} ?]</td></tr>
<tr><td><b>Transfer Time:</b></td>
	<td>[? print format_date({date=> $_DATA{date_manifest}, format=>'#D/#M/#Y'}) ?]</td></tr>
<tr><td><b>Manifest Number:</b></td>
	<td>[? print $_DATA{manifest_id} ?]</td></tr>
<tr><td><b>Merchant ID:</b></td>
	<td>[? print $_DATA{merchant_id} ?]</td></tr>
</table>
<br>
<table width="100%" cellpadding="2px" cellspacing="0" border="0">
	<tr><td class="hdr">Cnsgmt Nbr</td>
  	<td class="hdr">Article Nbr</td>
    <td class="hdr">DeliverTo</td>
    <td class="hdr">Suburb</td>
    <td class="hdr">Postcode</td>
    <td class="hdr">Country</td>
    <td class="hdr">Charge Code Description</td>
    <td class="hdr">Dngrous Goods</td>
    <td class="hdr">Total Articles in Consgmt</td>
    <td class="hdr">Cubic Weight</td>
    <td class="hdr">Actual Weight</td>
    <td class="hdr">Chargeable Weight</td></tr>
<!--##[?
$stotal_con = 
	$stotal_art = 
	$stotal_cubic =
	$stotal_shipping =
	$stotal_charge =
	$total_con =
	$total_art =
	$total_cubic =
	$total_shipping =
	$total_charge = 0;

$danger_flag = '0';
my $db_mid = db_quote($_DATA{manifest_id});

	
	my $sql2 = "SELECT C.*, O.ship_city, O.ship_zip, O.ship_country, O.ship_first_name, O.ship_last_name, O.ship_company, ".
		"S.shserv_code, S.shserv_name ".
		"FROM SH_CONSIGNMENTS C INNER JOIN ORDERS O USING (order_id) LEFT JOIN SH_SERVICES S USING (shserv_id) ".
		"WHERE manifest_id=$db_mid ORDER BY cngmt_id";
	my $sth2 = run_sql_dyn($sql2);
	while($cng = $sth2->fetchrow_hashref) {

		my $db_cid = db_quote($cng->{cngmt_id});

		my $art_count = 0;
		my $sql3 = "SELECT * FROM SH_ARTICLES WHERE cngmt_id=$db_cid ORDER BY art_id";
		my $sth3 = run_sql_dyn($sql3);
		my $art_total = $sth3->rows;
		while($row = $sth3->fetchrow_hashref) {
			my %TMP = (%{$zr}, %{$cng}, %{$row});
			$TMP{cubic} = sprintf("%.02f", $TMP{cubic} * $TMP{cubic_modifier});
			$TMP{shipping} = sprintf("%.02f", $TMP{shipping});
			if($TMP{shipping} <=0) { $TMP{shipping}=0.01; }
			$TMP{charge} = ($TMP{cubic}>$TMP{shipping}? $TMP{cubic}: $TMP{shipping});
			
			if($art_count==0) {
				$TMP{ship_country_name} = country_name($TMP{ship_country});
				$TMP{name} = ($TMP{ship_first_name} eq '' ? $TMP{ship_company} : $TMP{ship_first_name}.' '.$TMP{ship_last_name});
				my $danger_txt = ($TMP{danger} eq 'y'? 'Y' : 'N');
				if ( $TMP{danger} eq 'y' ) { 
					$danger_flag  = '1';
				}
				print qq~##-->
<tr><td class="itm">$TMP{cngmt_number}</td>
  <td class="itm">$TMP{article_number}</td>
  <td class="itm">$TMP{name}</td>
  <td class="itm">$TMP{ship_city}</td>
  <td class="itm">$TMP{ship_zip}</td>
  <td class="itm">$TMP{ship_country_name}</td>
  <td class="itm">$TMP{shserv_name}</td>
  <td class="itm" align="center">$danger_txt</td>
  <td class="itm" align="right">$art_total</td>
  <td class="itm" align="right">$TMP{cubic}</td>
  <td class="itm" align="right">$TMP{shipping}</td>
  <td class="itm" align="right">$TMP{charge}</td></tr>
<!--##~;
			} else {
				print qq~##-->
<tr><td class="itm">&nbsp;</td>
  <td class="itm">$TMP{article_number}</td>
  <td class="itm">&nbsp;</td>
  <td class="itm">&nbsp;</td>
  <td class="itm">&nbsp;</td>
  <td class="itm">&nbsp;</td>
  <td class="itm">&nbsp;</td>
  <td class="itm" align="center">&nbsp;</td>
  <td class="itm" align="right">&nbsp;</td>
  <td class="itm" align="right">$TMP{cubic}</td>
  <td class="itm" align="right">$TMP{shipping}</td>
  <td class="itm" align="right">$TMP{charge}</td></tr>
<!--##~;
			}
			$art_count++;
			
			$stotal_art++;
			$stotal_cubic+=$TMP{cubic};
			$stotal_shipping+=$TMP{shipping};
			$stotal_charge+=$TMP{charge};
		}
		$stotal_con++;
	
	my $cng_txt = ($stotal_con==1?'consignment':'consignments');
	$stotal_cubic = sprintf("%.02f", $stotal_cubic);
	$stotal_shipping = sprintf("%.02f", $stotal_shipping);
	$stotal_charge = sprintf("%.02f", $stotal_charge);


	$total_con +=$stotal_con;
	$total_art +=$stotal_art;
	$total_cubic +=$stotal_cubic;
	$total_shipping +=$stotal_shipping;
	$total_charge += $stotal_charge;

	$stotal_con =
	$stotal_art =
	$stotal_cubic =
	$stotal_shipping =
	$stotal_charge = 0;
}

?]##-->
<tr><td colspan="13" style="border-top: 2px solid #000000;">&nbsp;</td></tr>
<tr><td class="total" colspan="8"><b>Total</b> (for  <!--##[? print $total_con.' '.($total_con==1?'consignment':'consignments') ?]##-->)</td>
<td class="total" align="right">[? printf("%.02f", $total_art) ?]</td>
<td class="total" align="right">[? printf("%.02f", $total_cubic) ?]</td>
<td class="total" align="right">[? printf("%.02f", $total_shipping) ?]</td>
<td class="total" align="right">[? printf("%.02f", $total_charge) ?]</td></tr>
<tr><td colspan="13" style="border-bottom: 2px solid #000000; ">&nbsp;</td></tr>
</table>
<table cellpadding="0" cellspacing="0" width="100%" border="0">
	<tr><td colspan="2" height="20px">
	<b><font style="font-size:13px;">Dangerous Goods Warranty</font><br>
	<p style="font-size:11px;">I hereby declare that these shipments do not contain dangerous goods.<br>
Star Track Express is not a common carrier.<br></p>
Please refer to the terms and conditions on the paperless tranding agreement signed by an authorised officer of your company.<br>
	Each consighment is tendered for carriage by air subject to the conditions printed on the paperless trading agreement.<br>
Sender warrants that the terms and conditions of contract have been read and accpeted.
	</td></tr>
	<tr><td colspan="2" height="50px" align="right">Sender's signature ________________________________<br /><br />
  Driver's signature ________________________________</td></tr>
  <tr><td valign="top" nowrap><font style="font-size:13px;">Multiple Pickup? (Tick)</font></td>
  	<td><table width="100%" cellpadding="0" cellspacing="0" border="0" align="center"><tr>
  	 <td align = "right"><font style="font-size:13px;"><b>Yes</b></font>&nbsp;</td><td><div style="border:1px solid #000000; background-color:#FFFFFF; width:20px; height:20px;"></div></td>
<td align = "right"><font style="font-size:13px;"><b>No</b></font>&nbsp;</td><td><div style="border:1px solid #000000; background-color:#FFFFFF; width:20px; height:20px;"></div></td></tr></table>
</td>
</tr>
	<tr><td colspan="2" height="20px"><u>For [? print $_DATA{shacc_name} ?] Use</u></td></tr>
	<tr><td width="50%" valign="top">
<table cellpadding="0" class="inpbox"  cellspacing="0" width="100%" border="0">
	<tr><td valign="top" width="1%" nowrap>Checked by:</td><td>&nbsp;<br />&nbsp;</td></tr>
	<tr><td valign="top" nowrap>Time received:</td><td>&nbsp;<br />&nbsp;</td></tr>
	<tr><td valign="top" nowrap>Date received:</td><td>&nbsp;<br />&nbsp;</td></tr>
	<tr><td valign="top" nowrap>Number of ULDs:</td><td>&nbsp;<br />&nbsp;</td></tr>
</table>
  </td>
  	<td width="50%" align="right" valign="top">
<table cellpadding="0" class="inpbox"  cellspacing="0" width="100%" border="0">
	<tr><td valign="top" width="1%" nowrap>Approx no. of articles:</td><td>&nbsp;<br />&nbsp;</td></tr>
	<tr><td valign="top" nowrap>Type of revenue check:</td><td>&nbsp;<br />&nbsp;</td></tr>
	<tr><td valign="top" nowrap>Acceptance scan performed<br />
  	(date/time/initials)</td><td>&nbsp;<br />&nbsp;</td></tr>
	<tr><td valign="top" nowrap>Accepted in eParcel system<br />
  	(date/time/initials)</td><td>&nbsp;<br />&nbsp;</td></tr>
</table>
    </td></tr>
</table>