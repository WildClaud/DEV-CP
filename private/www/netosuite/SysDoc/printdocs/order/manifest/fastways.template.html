<font style="font-size:16px; font-weight:bold;">Print Manifest Report</font>
<br><br>
<table cellpadding="2px" cellspacing="0" border="0">
<tr><td colspan="2"><b>[? print $_DATA{shacc_name} ?] Manifest for [? print $_DATA{lodgement_title} ?]</b></td></tr>
<tr><td><b>Customer's Address:</b></td>
	<td>[? print $_DATA{lodgement_address} ?]</td></tr>
<tr><td><b>Manifest Number:</b></td>
	<td>[? print $_DATA{manifest_id} ?]</td></tr>
<tr>
	<td><b>Account ID:</b></td>
	<td>[? print $_DATA{merchant_id} ?]</td></tr>
<tr><td><b>Merchant Location ID:</b></td>
	<td>[? print $_DATA{location_id} ?]</td></tr>
<tr>
	<td><b>Account Name:</b></td>
	<td>[? print $_DATA{merchant_acc} ?]</td></tr>
</table>
<br>
<table width="100%" cellpadding="2px" cellspacing="0" border="0">
	<tr><td class="hdr">Cnsgmt Nbr</td>
  	<td class="hdr">Article Nbr</td>
    <td class="hdr">DeliverTo</td>
    <td class="hdr">Suburb / Postcode</td>
    <td class="hdr">Country</td>
    <td class="hdr">&nbsp;</td>
    <td class="hdr">Dngrous Goods</td>
    <td class="hdr">Total Articles in Consgmt</td>
    <td class="hdr">Extra/ Transit Cover</td>
    <td class="hdr">Cubic Weight</td>
    <td class="hdr">Actual Weight</td>
    <td class="hdr">Chargeable Weight</td></tr>
<!--##[?
$stotal_con =
$stotal_art =
$stotal_cubic =
$stotal_shipping =
$stotal_charge =
$total_con =
$total_art =
$total_cubic =
$total_shipping =
$total_charge = 0;

my $db_mid = db_quote($_DATA{manifest_id});

	my $sql2 = "SELECT C.*, O.ship_city, O.ship_zip, O.ship_country, O.ship_first_name, O.ship_last_name, O.ship_company, ".
		"S.shserv_code, S.shserv_name ".
		"FROM SH_CONSIGNMENTS C INNER JOIN ORDERS O USING (order_id) LEFT JOIN SH_SERVICES S USING (shserv_id) ".
		"WHERE manifest_id=$db_mid ORDER BY cngmt_id";
	my $sth2 = run_sql_dyn($sql2);
	while($cng = $sth2->fetchrow_hashref) {

		my $db_cid = db_quote($cng->{cngmt_id});

		my $art_count = 0;
		my $sql3 = "SELECT * FROM SH_ARTICLES WHERE cngmt_id=$db_cid ORDER BY art_id";
		my $sth3 = run_sql_dyn($sql3);
		my $art_total = $sth3->rows;
		while($row = $sth3->fetchrow_hashref) {
			my %TMP = (%{$zr}, %{$cng}, %{$row});
			$TMP{cubic} = sprintf("%.02f", $TMP{cubic} * $TMP{cubic_modifier});
			$TMP{shipping} = sprintf("%.02f", $TMP{shipping});
			if($TMP{shipping} <=0) { $TMP{shipping}=0.01; }
			$TMP{charge} = ($TMP{cubic}>$TMP{shipping}? $TMP{cubic}: $TMP{shipping});
			
			if($art_count==0) {
				$TMP{ship_country_name} = country_name($TMP{ship_country});
				$TMP{name} = ($TMP{ship_first_name} eq '' ? $TMP{ship_company} : $TMP{ship_first_name}.' '.$TMP{ship_last_name});
				my $tran_txt = ($TMP{transit_cover}>0? 'Y' : 'N');
				my $danger_txt = ($TMP{danger} eq 'y'? 'Y' : 'N');
				print qq~##-->
<tr><td class="itm">$TMP{cngmt_number}</td>
  <td class="itm">$TMP{article_number}</td>
  <td class="itm">$TMP{name}</td>
  <td class="itm">$TMP{ship_city} $TMP{ship_zip}</td>
  <td class="itm">$TMP{ship_country_name}</td>
  <td class="itm">&nbsp;</td>
  <td class="itm" align="center">$danger_txt</td>
  <td class="itm" align="right">$art_total</td>
  <td class="itm" align="center">$tran_txt</td>
  <td class="itm" align="right">$TMP{cubic}</td>
  <td class="itm" align="right">$TMP{shipping}</td>
  <td class="itm" align="right">$TMP{charge}</td></tr>
<!--##~;
			} else {
				print qq~##-->
<tr><td class="itm">&nbsp;</td>
  <td class="itm">$TMP{article_number}</td>
  <td class="itm">&nbsp;</td>
  <td class="itm">&nbsp;</td>
  <td class="itm">&nbsp;</td>
  <td class="itm">&nbsp;</td>
  <td class="itm" align="center">&nbsp;</td>
  <td class="itm" align="right">&nbsp;</td>
  <td class="itm" align="center">$tran_txt</td>
  <td class="itm" align="right">$TMP{cubic}</td>
  <td class="itm" align="right">$TMP{shipping}</td>
  <td class="itm" align="right">$TMP{charge}</td></tr>
<!--##~;
			}
			$art_count++;
			
			$stotal_art++;
			$stotal_cubic+=$TMP{cubic};
			$stotal_shipping+=$TMP{shipping};
			$stotal_charge+=$TMP{charge};
		}
		$stotal_con++;
	}
	
	my $cng_txt = ($stotal_con==1?'consignment':'consignments');
	$stotal_cubic = sprintf("%.02f", $stotal_cubic);
	$stotal_shipping = sprintf("%.02f", $stotal_shipping);
	$stotal_charge = sprintf("%.02f", $stotal_charge);

	$total_con +=$stotal_con;
	$total_art +=$stotal_art;
	$total_cubic +=$stotal_cubic;
	$total_shipping +=$stotal_shipping;
	$total_charge += $stotal_charge;

	$stotal_con =
	$stotal_art =
	$stotal_cubic =
	$stotal_shipping =
	$stotal_charge = 0;


?]##-->
<tr><td colspan="12" style="border-top: 2px solid #000000;">&nbsp;</td></tr>
<tr><td class="total" colspan="7"><b>Total</b> (for  <!--##[? print $total_con.' '.($total_con==1?'consignment':'consignments') ?]##-->)</td>
<td class="total" align="right">[? printf("%d", $total_art) ?]</td>
<td class="total">&nbsp;</td>
<td class="total" align="right">[? printf("%.02f", $total_cubic) ?]</td>
<td class="total" align="right">[? printf("%.02f", $total_shipping) ?]</td>
<td class="total" align="right">[? printf("%.02f", $total_charge) ?]</td></tr>
<tr><td colspan="12" style="border-bottom: 2px solid #000000; ">&nbsp;</td></tr>
</table>
<table cellpadding="0" cellspacing="0" width="100%" border="0">
<tr><td colspan="2" height="50px" align="right">Sender's signature ________________________________</td></tr>
	<tr><td colspan="2" height="20px"><u>For [? print $_DATA{shacc_name} ?] Use</u></td></tr>
	<tr><td width="50%" valign="top">
<table cellpadding="0" class="inpbox"  cellspacing="0" width="100%" border="0">
	<tr><td valign="top" width="1%" nowrap>Checked by:</td><td>&nbsp;<br />&nbsp;</td></tr>
	<tr><td valign="top" nowrap>Time received:</td><td>&nbsp;<br />&nbsp;</td></tr>
	<tr><td valign="top" nowrap>Date received:</td><td>&nbsp;<br />&nbsp;</td></tr>
	<tr>
	  <td valign="top" nowrap>Number of articles:</td><td>&nbsp;<br />&nbsp;</td></tr>
</table>
  </td>
  	<td width="50%" align="right" valign="top">&nbsp;</td></tr>
</table>