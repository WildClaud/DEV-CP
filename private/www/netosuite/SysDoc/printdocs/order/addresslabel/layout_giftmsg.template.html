<!--##[?
	my $tracking_id = get_one("SELECT tracking_id from ORDERTRACKINGS WHERE order_id=? AND cngmt_id=?", $_DATA{order_id}, $_DATA{cngmt_id});
	
	my %LINES = ();
	if($tracking_id > 0) {
		my $gpctr = 0;
		
		my $sql = "SELECT counter,SKU,description,quantity,extra,bin_loc,pk_quantity FROM ORDERLINES WHERE order_id=? AND tracking_id=? ORDER BY counter";
		my $sth = run_sql_dyn($sql,$_DATA{order_id},$tracking_id);
		while(my $row = $sth->fetchrow_hashref) {
			my %TMP = %{$row};
			
			my @etmp = get_full_item_extra_list($TMP{SKU},$TMP{extra});
			
			my $key1 = ''; my $find1 = 0;
			my $key2 = ''; my $find2 = 0;
			$TMP{extra} = '';
			for(my $i=0; $i<scalar(@etmp); $i++) {
				if(!$find2 && lc($etmp[$i]{name}) eq $_DATA{giftmsgid}) {
					$key2 = $etmp[$i]{value};
				} else {
					if($_DATA{giftmsgp} eq '*') {
						$key1 = $gpctr; $gpctr++;
					} elsif(!$find1 && lc($etmp[$i]{name}) eq $_DATA{giftmsgp}) {
						$key1 = lc($etmp[$i]{value});
						$TMP{extra} = ($etmp[$i]{name} eq ''? '':'<b>'.$etmp[$i]{name}.'</b>: ').nohtml($etmp[$i]{value}).'; '.$TMP{extra};
					} else {
						$TMP{extra} .= ($etmp[$i]{name} eq ''? '':'<b>'.$etmp[$i]{name}.'</b>: ').nohtml($etmp[$i]{value}).'; ';
					}
				}
			}
			if(!defined($LINES{$key1})) { $LINES{$key1} = {}; }
			if(!defined($LINES{$key1}{$key2})) {
				$LINES{$key1}{$key2} = [];
			}
			
			my %tmp2 = %TMP;
			push @{$LINES{$key1}{$key2}}, \%TMP;
		}
	}
	
	if( scalar(keys %LINES) == 0 ) {
		my $key1 = '';
		my $key2 = '';
		$LINES{$key1}{$key2} = [];
	}
	
	my $count = 0;
	my $giftcardnum = 1;

	my $address = trim("$_DATA{ship_first_name} $_DATA{ship_last_name}").'<br>';
	$address .= $_DATA{ship_company}. ($_DATA{ship_company} eq ''? '': '<br>');
	$address .= $_DATA{ship_street1} .'<br>';
	$address .= $_DATA{ship_street2}. ($_DATA{ship_street2} eq ''? '': '<br>');
	$address .= "$_DATA{ship_city} $_DATA{ship_state} $_DATA{ship_zip}";
	
	my $tpage = 0;
	if($TMP::LAST_TRACKING_ID != $tracking_id) {
		for my $key1 (keys %LINES) {
			for my $key2 (keys %{$LINES{$key1}}) {
				my $ccpage += ceil(scalar(@{$LINES{$key1}{$key2}}) / 10);
				if($ccpage<=0) {$ccpage=1;}
				$tpage += $ccpage;
			}
		}
	}
	if($tpage<=0) { $tpage = 1; }
	
	my $cpage = 0;
	for my $key1 (keys %LINES) {
		for my $key2 (keys %{$LINES{$key1}}) {
			my $curitm = 0;
			my $totalitems = scalar(@{$LINES{$key1}{$key2}});

			if($TMP::LAST_TRACKING_ID == $tracking_id) {
				$totalitems = 0;
			}
			
			my $cpart = $_DATA{art_id}+1;
			
			while( $curitm <$totalitems  || !$count) {
				$cpage++;
				
				if($count) {
					print qq~##--><hr class="pagebreak"><!--##~; 
				}
				
		
				print qq~##--><div align="left" class="pageinner" style="width:$TMP::PAGEWIDTH;"><!--##~; 
				print qq~##-->
	<table cellpadding="0" cellspacing="0" border="0" width="100%" align="center">
	<tr>
	<td rowspan="2"><!--##~; 
				if($_DATA{company_logo} eq '') {
					print qq~##--><div style="width:200px; height:70px; overflow:hidden;"><b>$_DATA{bill_company}</b></div><!--##~;
				} else {
					print qq~##--><img src="$_DATA{company_logo}" alt="Logo" width="200px" height="70px" /><!--##~;
				}
				print qq~##-->
	</td>
	<td>
	   <b>Order Number: $_DATA{order_id}<br />
	   Purchase Order Number: $_DATA{customer_po}</b><br />
	</td>
	</tr>
	<tr>
	<td align="right">
		Parcel $cpart of $_DATA{total}<br />
		Page $cpage of $tpage<br />
	</td>
	</tr>
	<tr><td colspan="2">
<div style="height:440px; overflow:hidden;">
<table cellpadding="4" cellspacing="0" width="100%">
	<tr>
		<td width="1%" style="border: 1px solid #000;" nowrap><b>Qty</b></td>
		<td width="1%" style="border-right: 1px solid #000; border-top: 1px solid #000; border-bottom: 1px solid #000; border-top: 1px solid #000;" nowrap><b>SKU</b></td>
		<td style="border-right: 1px solid #000; border-top: 1px solid #000; border-bottom: 1px solid #000; border-top: 1px solid #000;"><b>Description</b></td>
		<td width="1%" style="border-right: 1px solid #000; border-top: 1px solid #000; border-bottom: 1px solid #000; border-top: 1px solid #000;" nowrap><b>BIN Loc</b></td>
		<td width="1%" style="border-right: 1px solid #000; border-top: 1px solid #000; border-bottom: 1px solid #000; border-top: 1px solid #000;" nowrap><b>Qty Picked</b></td>
	</tr>
<!--##~;
				for(my $ci=0; $curitm<$totalitems && $ci<10; $ci++) {
					my %TMP = %{$LINES{$key1}{$key2}[$curitm]};
					print qq~##-->
<tr>
	<td style="border-right: 1px solid #000; border-left: 1px solid #000; border-bottom: 1px solid #000;" nowrap><b>$TMP{quantity}</b></td>
	<td style="border-right: 1px solid #000; border-bottom: 1px solid #000; border-bottom: 1px solid #000;" nowrap>$TMP{SKU}&nbsp;</td>
	<td style="border-right: 1px solid #000; border-bottom: 1px solid #000; border-bottom: 1px solid #000;">$TMP{description}<br /><font class="tiny">$TMP{extra}</font></td>
	<td style="border-right: 1px solid #000; border-bottom: 1px solid #000; border-bottom: 1px solid #000;" nowrap>$TMP{bin_loc}&nbsp;</td>
	<td style="border-right: 1px solid #000; border-bottom: 1px solid #000; border-bottom: 1px solid #000;" nowrap>&nbsp;</td>
</tr>
<!--##~;
					$curitm++;
				}
				
				my $giftmsg = $key2;
				$giftmsg =~ s/\n/<br>/gis;
	
				print qq~##-->
</table>
</div>
	</td></tr>
	<tr><td width="350px" valign="top">
<div style="font-size:18px; height:140px; overflow:hidden;">
<b>$address</b>
</div>
<div style="font-size:10px; height:100px; overflow:hidden;"><b>Gift Card No.
<!--##~;
				if($giftmsg ne '') { print $giftcardnum; $giftcardnum++; }
				print qq~##--></b></div>
<div style="width:210px; height:300px; margin-left:15px; font-size:13px;">
$giftmsg
</div>
	</td><td width="350px" valign="top">
<div style="font-size:12px; width:350px; overflow:hidden;word-wrap: break-word;">
<!--##~;
				if(!$count) { print $_DATA{label}; }
				print qq~##-->
</div>
	</td></tr>
</table>
<!--##~;
				print qq~##--></div><!--##~; 
				$count++;
			}
		}
	}

	$TMP::LAST_TRACKING_ID = $tracking_id;

?]##-->
